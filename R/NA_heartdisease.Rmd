---
title: "NA_heartdisease"
author: "Jelena Meyer"
date: "2023-06-19"
output: html_document
---

```{r Preparations}

# get name of data set:
get_object_name <- function(x){
  deparse(substitute(x))
}

# Check:
#get_object_name(heartdisease)
```


```{r Get-tree-for-original-data}

#Build tree for normal data set:
x <- FFTrees(formula = diagnosis ~.,
             data = heartdisease,
             main = get_object_name(heartdisease),
             goal = "bacc",
             goal.chase = "bacc",
             goal.threshold = "bacc")

# Performance:
x_summary <- summary(x)
x_stats_1 <- x_summary$stats$train[1, ]
# x_stats_1

# get tree definitions;
x_fft_df <- get_fft_df(x)
fft_df <- x_fft_df[1, ]  # best training tree
```


```{r build-loop-function}

loop_NA <- function(data, criterion, pc){

  
# Prepare for loop:
  # Parameters:
  n_per_NA <- 10
  n_sims <- n_per_NA

# initialize data structure to collect results:
results <- data.frame(matrix(NA, nrow = 1 + n_sims, ncol = 26))

# results:
n_col <- ncol(x_stats_1)
results[1, 1:n_col] <- x_stats_1

  
# Prepare vectors as input for replace_values function:  
   # get all names of variables but exclude criterion: 
   col_names <- names(data)
   col_names <- col_names[col_names != criterion ]
  
   # build vector with NA percentage: 
   num_cols <- length(col_names)
   pc_per_row <- pc

   # create vector with that pc for number of rows:
   pc_vec <- rep(pc_per_row, times = num_cols)

  
# Loop 1: ---- 
for (i in 1:n_sims){

# Add NAs to data:
data_NA <- replace_values(data = data, 
                          cols = col_names, 
                          amount = pc_vec, 
                          replacement = NA, 
                          levels_amount = NULL)

  
# Apply tree definition to (OLD/NBW) data:
y <- FFTrees(object = x,
             tree.definitions = fft_df,
             data = data_NA, 
             quiet = TRUE, 
             do.comp = FALSE)

# Collect results:

# a) tree performance: 
y_summary <- summary(y)
y_stats <- y_summary$stats$train

# b) level stats:
y_level_stats <- y$trees$level_stats$train
NA_stats <- y_level_stats[nrow(y_level_stats) , c(25 :30)]

# Combine:
all_data_df <- cbind(y_stats, NA_stats)
# dim(all_data_df)


# Collect results:
results[(1 + i), ] <- all_data_df

} # for loop. 

  
# After loop:

# Add column names to data frame:
names(results) <- names(all_data_df)

       
# Output: ----
return(results) # as data frame.

} # loop_NA().
```


```{r apply-loop-function-25-na}
# use loop-function, input = 25% nas:
heart_NA_25 <- loop_NA(heartdisease, "diagnosis", 0.25)
```





```{r apply-loop-function-50-na}
# use loop-function, input = 50% nas:
heart_NA_50 <- loop_NA(heartdisease, "diagnosis", 0.50)
```




```{r apply-loop-function-75-na}
# use loop-function, input = 75% nas:
heart_NA_75 <- loop_NA(heartdisease, "diagnosis", 0.75)
```



```{r apply-loop-function-100-na}
# how many rows are in the data set:
n <- nrow(heartdisease)

# use loop-function, input = 100% nas:
heart_NA_100 <- loop_NA(heartdisease, "diagnosis", n)
```



